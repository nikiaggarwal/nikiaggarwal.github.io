<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Promises Made | The Mamdani Meter</title>
  <meta name="description" content="Track all the promises made by NYC City Hall" />
  <link rel="canonical" href="https://themamdanimeter.com/promises.html" />
  <meta property="og:title" content="Promises Made | The Mamdani Meter" />
  <meta property="og:description" content="Track all the promises made by NYC City Hall" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://themamdanimeter.com/promises.html" />
  <meta property="og:image" content="https://themamdanimeter.com/images/MM Logo.png" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Promises Made | The Mamdani Meter" />
  <meta name="twitter:description" content="Track all the promises made by NYC City Hall" />
  <meta name="twitter:image" content="https://themamdanimeter.com/images/MM Logo.png" />

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="images/MM Logo.png" />
  <link rel="apple-touch-icon" href="images/MM Logo.png" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Archivo+Black&family=IBM+Plex+Sans:wght@400;600;700;800;900&family=IBM+Plex+Mono:wght@400;600&display=swap"
    rel="stylesheet"
  />

  <!-- Global Styles -->
  <link rel="stylesheet" href="styles.css" />

  <!-- Privacy-friendly analytics by Plausible -->
  <script async src="https://plausible.io/js/pa-jyb0zobCuDsT0C5VAgYRm.js"></script>
  <script>
    window.plausible=window.plausible||function(){(plausible.q=plausible.q||[]).push(arguments)},plausible.init=plausible.init||function(i){plausible.o=i||{}};
    plausible.init()
  </script>
</head>

<body>
  <a class="skip-link" href="#main">Skip to main content</a>

  <!-- NAV -->
  <header class="nav" role="banner">
    <div class="nav-inner">
      <a class="brand" href="/" aria-label="The Mamdani Meter home">
        <!-- small static meter icon -->
        <svg width="28" height="28" viewBox="0 0 28 28" aria-hidden="true">
          <path d="M4 18a10 10 0 0 1 20 0" fill="none" stroke="#ffffff" stroke-width="3" stroke-linecap="square"/>
        </svg>
        <span>THE MAMDANI METER</span>
      </a>

      <nav aria-label="Primary">
        <ul class="nav-links">
          <li><a href="/">Home</a></li>
          <li><a href="/promises.html" aria-current="page">Promises</a></li>
          <li><a href="/faq.html">FAQ</a></li>
          <li><a href="/subscribe.html">Weekly Scorecard</a></li>
        </ul>
      </nav>

      <button class="hamburger" type="button" aria-label="Open menu" aria-expanded="false" aria-controls="mobileMenu">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path fill="currentColor" d="M3 6h18v2H3V6zm0 5h18v2H3v-2zm0 5h18v2H3v-2z"/>
        </svg>
      </button>
    </div>
  </header>

  <!-- MOBILE MENU -->
  <div id="mobileMenu" class="mobile-overlay" role="dialog" aria-modal="true" aria-label="Mobile menu" hidden>
    <div class="mobile-top">
      <div class="title">Menu</div>
      <button class="mobile-close" type="button" aria-label="Close menu">Close</button>
    </div>
    <ul class="mobile-menu">
      <li><a href="/">Home</a></li>
      <li><a href="/promises.html" aria-current="page">Promises</a></li>
      <li><a href="/subscribe.html">Weekly Scorecard</a></li>
      <li><a href="/faq.html">FAQ</a></li>
    </ul>
  </div>

  <main id="main">
    <!-- PAGE HEADER -->
    <section class="promises-header">
      <div class="promises-container">
        <h1 class="h1">PROMISES MADE</h1>
        <p class="promises-subtitle">Tracking the commitments, progress, and roadblocks across NYC City Hall's agenda</p>
      </div>
    </section>

    <!-- FILTER SECTION -->
    <section class="filters-section" id="filtersSection">
      <div class="promises-container">
        <div class="filter-group">
          <div class="filter-label">Status</div>
          <div class="filter-chips" role="group" aria-label="Filter by status">
            <button class="filter-chip active" data-filter-type="status" data-filter-value="All">All</button>
            <button class="filter-chip" data-filter-type="status" data-filter-value="Delivered">Delivered</button>
            <button class="filter-chip" data-filter-type="status" data-filter-value="Making Progress">Making Progress</button>
            <button class="filter-chip" data-filter-type="status" data-filter-value="Early Days">Early Days</button>
            <button class="filter-chip" data-filter-type="status" data-filter-value="Headwinds">Headwinds</button>
            <button class="filter-chip" data-filter-type="status" data-filter-value="Nope">Nope</button>
          </div>
        </div>

        <div class="filter-group">
          <div class="filter-label">Category</div>
          <div class="filter-chips" role="group" aria-label="Filter by category">
            <button class="filter-chip active" data-filter-type="category" data-filter-value="All">All</button>
            <button class="filter-chip" data-filter-type="category" data-filter-value="Housing">Housing</button>
            <button class="filter-chip" data-filter-type="category" data-filter-value="Small Business">Small Business</button>
            <button class="filter-chip" data-filter-type="category" data-filter-value="Education">Education</button>
            <button class="filter-chip" data-filter-type="category" data-filter-value="Labor">Labor</button>
            <button class="filter-chip" data-filter-type="category" data-filter-value="Affordability">Affordability</button>
            <button class="filter-chip" data-filter-type="category" data-filter-value="Climate">Climate</button>
            <button class="filter-chip" data-filter-type="category" data-filter-value="LGBTQ+">LGBTQ+</button>
          
            <button class="filter-chip" data-filter-type="category" data-filter-value="Community">Community</button>
            <button class="filter-chip" data-filter-type="category" data-filter-value="Reform & Funding">Reform & Funding</button>
            <button class="filter-chip" data-filter-type="category" data-filter-value="Trump-Proofing">Trump-Proofing</button>
          </div>
        </div>
      </div>
    </section>

    <!-- PROMISES GRID -->
    <section class="promises-grid-section">
      <div class="promises-container">
        <div id="promisesGrid" class="promise-list" aria-label="Promises list">
          <!-- Rows injected by JS -->
        </div>

        <!-- Empty State -->
        <div id="emptyState" class="empty-state" hidden>
          <p>No promises match these filters</p>
          <button class="btn btn-secondary" id="clearFiltersBtn">Clear Filters</button>
        </div>
      </div>
    </section>
  </main>

  <footer>

    <div class="footer-bg-text">NYC</div>
    <div class="footer-inner container">
      <div class="footer-grid">
        <div>
          <div class="footer-tagline">TRACKING POLICY,<br><span>NOT POLITICS.</span></div>
          <div class="footer-about">
            <p>The Mamdani Meter tracks every campaign promise made by Zohran Mamdani â€” from introduction to implementation. Accountability, not spin.</p>
          </div>
        </div>
        <div class="footer-nav">
          <div class="footer-col-label">Navigate</div>
          <ul>
            <li><a href="/">Home</a></li>
            <li><a href="/promises.html">Promises</a></li>
            <li><a href="/faq.html">FAQ</a></li>
            <li><a href="/subscribe.html">Weekly Scorecard</a></li>
          </ul>
        </div>
        <div class="footer-subscribe">
          <div class="footer-col-label">Stay Updated</div>
          <script async src="https://subscribe-forms.beehiiv.com/embed.js"></script>
          <iframe src="https://subscribe-forms.beehiiv.com/90d70c81-5c52-43cb-a65d-5f76ea84cebd" class="beehiiv-embed" data-test-id="beehiiv-embed" frameborder="0" scrolling="no" style="width: 458px; height: 207px; margin: 0; border-radius: 0px !important; background-color: transparent; box-shadow: 0 0 #0000; max-width: 100%;"></iframe>
        </div>
      </div>
      <div class="footer-bottom">
        <div class="footer-brand">
          <img src="/images/MM Logo.png" alt="" width="28" height="28" aria-hidden="true">
          <div class="footer-brand-name">The Mamdani Meter</div>
        </div>
        <div class="footer-meta">
          Questions? <a href="mailto:hello@themamdanimeter.com">hello@themamdanimeter.com</a>
          &nbsp;&middot;&nbsp; &copy; 2026
        </div>
      </div>
    </div>
  </footer>

  <script>
    // --------------------------
    // GOOGLE SHEETS CONFIGURATION
    // --------------------------
    const SHEETS_CONFIG = {
      promises: "https://docs.google.com/spreadsheets/d/e/2PACX-1vQWWrJFChdFmerrKCrVf1fLiVmXFiTpaXdPxk1xGtLToZRiB3V3FXWoNAsl3cQmmyueJaroRaZrIQZ1/pub?gid=0&single=true&output=csv",
      cacheDuration: 5 * 60 * 1000
    };

    // Fallback data
    const FALLBACK_PROMISES = [
      {
        id: "p1",
        title: "Fund tenant legal support citywide",
        category: "Housing",
        status: "Headwinds",
        statusLabel: "Budget pending",
        oneLineSummary: "Funding discussions are active, but no final commitment yet."
      },
      {
        id: "p2",
        title: "Expand bus lanes on key corridors",
        category: "Transit",
        status: "Making Progress",
        statusLabel: "In motion",
        oneLineSummary: "Agencies are coordinating next steps and public input."
      },
      {
        id: "p3",
        title: "Launch paid youth internships",
        category: "Education",
        status: "Delivered",
        statusLabel: "Pilot live",
        oneLineSummary: "A pilot program is running with early results expected soon."
      },
      {
        id: "p4",
        title: "Improve subway accessibility timelines",
        category: "Transit",
        status: "Nope",
        statusLabel: "Stalled",
        oneLineSummary: "No clear plan or timeline has been published."
      },
      {
        id: "p5",
        title: "Strengthen workplace protections",
        category: "Labor",
        status: "Making Progress",
        statusLabel: "Drafting",
        oneLineSummary: "Policy language is taking shape with stakeholder feedback."
      },
      {
        id: "p6",
        title: "Build more deeply affordable housing",
        category: "Housing",
        status: "Headwinds",
        statusLabel: "Negotiating",
        oneLineSummary: "Key details depend on land, financing, and approvals."
      }
    ];

    // --------------------------
    // Data & State
    // --------------------------
    let allPromises = [];
    let filteredPromises = [];

    const filters = {
      status: 'All',
      category: 'All'
    };

    // --------------------------
    // Status Colors
    // --------------------------
    const STATUS = {
      "Delivered": { color: getCSS("--status-lets"), tint: "rgba(0, 204, 102, 0.08)" },
      "Making Progress": { color: getCSS("--status-alright"), tint: "rgba(179, 249, 91, 0.08)" },
      "Early Days": { color: getCSS("--status-early"), tint: "rgba(29, 222, 228, 0.08)" },
      "Headwinds": { color: getCSS("--status-oof"), tint: "rgba(255, 170, 15, 0.08)" },
      "Nope": { color: getCSS("--status-yikes"), tint: "rgba(255, 51, 51, 0.08)" }
    };

    function getCSS(varName){
      return getComputedStyle(document.documentElement).getPropertyValue(varName).trim();
    }

    // --------------------------
    // CSV Parser (handles commas, quotes, and newlines in fields)
    // --------------------------
    function parseCSV(text) {
      const rows = [];
      let current = '';
      let inQuotes = false;
      let row = [];

      for (let i = 0; i < text.length; i++) {
        const char = text[i];
        const nextChar = text[i + 1];

        if (inQuotes) {
          if (char === '"' && nextChar === '"') {
            current += '"';
            i++; // skip escaped quote
          } else if (char === '"') {
            inQuotes = false;
          } else {
            current += char;
          }
        } else {
          if (char === '"') {
            inQuotes = true;
          } else if (char === ',') {
            row.push(current.trim());
            current = '';
          } else if (char === '\n' || (char === '\r' && nextChar === '\n')) {
            if (char === '\r') i++; // skip \r in \r\n
            row.push(current.trim());
            current = '';
            if (row.length > 0 && row.some(cell => cell !== '')) {
              rows.push(row);
            }
            row = [];
          } else if (char !== '\r') {
            current += char;
          }
        }
      }
      // Handle last field/row
      if (current || row.length > 0) {
        row.push(current.trim());
        if (row.some(cell => cell !== '')) {
          rows.push(row);
        }
      }

      if (rows.length < 2) return [];

      const headers = rows[0];
      const result = [];
      for (let i = 1; i < rows.length; i++) {
        const values = rows[i];
        const obj = {};
        headers.forEach((header, index) => {
          obj[header] = values[index] || '';
        });
        result.push(obj);
      }
      return result;
    }

    // --------------------------
    // Fetch Promises
    // --------------------------
    async function fetchPromises() {
      try {
        const cached = localStorage.getItem('promises_cache');
        if (cached) {
          const { data, timestamp } = JSON.parse(cached);
          if (Date.now() - timestamp < SHEETS_CONFIG.cacheDuration) {
            return data;
          }
        }

        const response = await fetch(SHEETS_CONFIG.promises);
        if (!response.ok) throw new Error(`HTTP ${response.status}`);
        const text = await response.text();
        const data = parseCSV(text);

        localStorage.setItem('promises_cache', JSON.stringify({
          data,
          timestamp: Date.now()
        }));

        return data;
      } catch (error) {
        console.warn('Failed to fetch promises:', error);
        if (cached) {
          return JSON.parse(cached).data;
        }
        return FALLBACK_PROMISES;
      }
    }

    // --------------------------
    // Filter Promises
    // --------------------------
    function filterPromises() {
      filteredPromises = allPromises.filter(p => {
        const statusMatch = filters.status === 'All' || p.status === filters.status;
        const categoryMatch = filters.category === 'All' || p.category === filters.category;
        return statusMatch && categoryMatch;
      });

      renderPromises();
    }

    // --------------------------
    // Render Promises
    // --------------------------
    function renderPromises() {
      const list = document.getElementById('promisesGrid');
      const emptyState = document.getElementById('emptyState');

      if (filteredPromises.length === 0) {
        list.innerHTML = '';
        emptyState.hidden = false;
        return;
      }

      emptyState.hidden = true;
      list.innerHTML = '';

      filteredPromises.forEach((p, index) => {
        const row = makePromiseRow(p);
        row.style.opacity = '0';
        list.appendChild(row);

        setTimeout(() => {
          row.style.transition = 'opacity 300ms ease-in';
          row.style.opacity = '1';
        }, index * 20);
      });
    }

    // --------------------------
    // Make Promise Row
    // --------------------------
    function makePromiseRow(p) {
      const s = STATUS[p.status] || STATUS["Early Days"];

      const a = document.createElement("a");
      a.className = `promise-row plausible-event-name=Promise+Click plausible-event-title=${encodeURIComponent(p.title)} plausible-event-category=${encodeURIComponent(p.category)} plausible-event-status=${encodeURIComponent(p.status)}`;
      a.href = `/promise/?id=${encodeURIComponent(p.id)}`;
      a.setAttribute("aria-label", `${p.title}. ${p.category}. ${p.status}.`);

      a.innerHTML = `
        <div class="promise-row-left">
          <div class="promise-title">${escapeHTML(p.title)}</div>
        </div>
        <div class="promise-row-right">
          <span class="promise-category">${escapeHTML(p.category)}</span>
          <span class="promise-status-badge" style="border-color:${s.color};background:${s.tint} !important">${escapeHTML(p.status).toUpperCase()}</span>
        </div>
        <svg class="promise-row-arrow" viewBox="0 0 24 24" aria-hidden="true">
          <path fill="currentColor" d="M9 6l6 6-6 6"/>
        </svg>
      `;
      return a;
    }

    function escapeHTML(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#39;");
    }

    // --------------------------
    // Filter Chip Handlers
    // --------------------------
    function setupFilterChips() {
      const chips = document.querySelectorAll('.filter-chip');

      chips.forEach(chip => {
        chip.addEventListener('click', () => {
          const filterType = chip.dataset.filterType;
          const filterValue = chip.dataset.filterValue;

          const siblings = document.querySelectorAll(`[data-filter-type="${filterType}"]`);
          siblings.forEach(s => s.classList.remove('active'));
          chip.classList.add('active');

          filters[filterType] = filterValue;
          filterPromises();
        });
      });
    }

    // --------------------------
    // Clear Filters
    // --------------------------
    document.getElementById('clearFiltersBtn').addEventListener('click', () => {
      filters.status = 'All';
      filters.category = 'All';

      document.querySelectorAll('.filter-chip').forEach(chip => {
        chip.classList.remove('active');
        if (chip.dataset.filterValue === 'All') {
          chip.classList.add('active');
        }
      });

      filterPromises();
    });

    // --------------------------
    // Initialize
    // --------------------------
    async function init() {
      allPromises = await fetchPromises();
      filteredPromises = allPromises;
      setupFilterChips();
      renderPromises();
    }

    init();

    // --------------------------
    // Mobile menu
    // --------------------------
    const hamburger = document.querySelector(".hamburger");
    const overlay = document.getElementById("mobileMenu");
    const closeBtn = document.querySelector(".mobile-close");
    let lastFocus = null;

    function openMenu(){
      lastFocus = document.activeElement;
      overlay.hidden = false;
      requestAnimationFrame(() => overlay.classList.add("open"));
      hamburger.setAttribute("aria-expanded","true");
      closeBtn.focus();
      document.body.style.overflow = "hidden";
    }
    function closeMenu(){
      overlay.classList.remove("open");
      hamburger.setAttribute("aria-expanded","false");
      document.body.style.overflow = "";
      setTimeout(() => {
        overlay.hidden = true;
        if(lastFocus) lastFocus.focus();
      }, 260);
    }

    hamburger.addEventListener("click", () => {
      const expanded = hamburger.getAttribute("aria-expanded") === "true";
      expanded ? closeMenu() : openMenu();
    });
    closeBtn.addEventListener("click", closeMenu);

    overlay.addEventListener("click", (e) => {
      if(e.target === overlay) closeMenu();
    });
    document.addEventListener("keydown", (e) => {
      if(!overlay.hidden && e.key === "Escape") closeMenu();
    });
  </script>
</body>
</html>
